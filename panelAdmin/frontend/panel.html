<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Panel de Administraci√≥n - Cafeter√≠a</title>
  <link rel="stylesheet" href="panel.css">
</head>
<body>
  <!-- Sidebar -->
  <div class="sidebar">
    <h2>‚òï Cafeter√≠a</h2>
    <ul>
      <li class="active" id="btnAdmin">Panel Administraci√≥n</li>
      <li id="btnCocina">Panel Cocina</li>
    </ul>
  </div>

  <!-- Contenido principal -->
  <div class="main-content">
    <h1>üìã Panel de Administraci√≥n</h1>
    <table id="tablaPedidos">
      <thead>
        <tr>
          <th>ID Pedido</th>
          <th>Usuario</th>
          <th>Correo</th>
          <th>Estado</th>
          <th>Fecha</th>
          <th>Productos</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <!-- Aqu√≠ se cargan los pedidos desde la BD -->
      </tbody>
    </table>
  </div>

  <!-- Modal Ver Pedido -->
  <div id="modalVer" class="modal">
    <div class="modal-content">
      <span id="cerrarModalVer" class="close">&times;</span>
      <h2>Detalles del Pedido</h2>
      <div id="detallePedidoVer"></div>
    </div>
  </div>

  <!-- Modal Editar Pedido -->
  <div id="modalEditar" class="modal">
    <div class="modal-content">
      <span id="cerrarModalEditar" class="close">&times;</span>
      <h2>Editar Pedido</h2>
      <form id="formEditarPedido">
        <input type="hidden" id="editarIdPedido">
        <label for="editarEstado">Estado:</label>
        <select id="editarEstado">
          <option value="pendiente">Pendiente</option>
          <option value="en preparacion">En preparaci√≥n</option>
          <option value="entregado">Entregado</option>
        </select>
        <div class="modal-actions">
          <button type="submit" class="btn btn-editar">Guardar</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal Pago/Eliminar Pedido -->
  <div id="modalPago" class="modal">
    <div class="modal-content">
      <span id="cerrarModalPago" class="close">&times;</span>
      <h2>Pago y Eliminaci√≥n de Pedido</h2>
      <div id="detallePedidoPago"></div>
      <div class="modal-actions">
        <button id="btnCambiarPagado" class="btn btn-pagar">Cambiar a Pagado</button>
        <button id="btnEliminarPedido" class="btn btn-eliminar">Eliminar Pedido</button>
      </div>
    </div>
  </div>

  <script src="/panelAdmin/js/panel.js"></script>
  <script>
  // Obtener y mostrar pedidos en la tabla
  async function cargarPedidos() {
    const tbody = document.querySelector('#tablaPedidos tbody');
    tbody.innerHTML = '<tr><td colspan="7">Cargando...</td></tr>';
    try {
      const res = await fetch('/api/pedidosPanel', { credentials: 'include' });
      const pedidos = await res.json();
      tbody.innerHTML = '';
      pedidos.forEach(pedido => {
        tbody.innerHTML += `
          <tr>
            <td>${pedido.id_pedido}</td>
            <td>${pedido.usuario}</td>
            <td>${pedido.correo}</td>
            <td>${pedido.estado}</td>
            <td>${new Date(pedido.fecha_pedido).toLocaleString()}</td>
            <td>${pedido.productos || ''}</td>
            <td>
              <button class="btn btn-ver" onclick="verPedido('${pedido.id_pedido}')">Ver</button>
              <button class="btn btn-editar" onclick="editarPedido('${pedido.id_pedido}')">Editar</button>
              <button class="btn btn-pago" onclick="pagoPedido('${pedido.id_pedido}')">Pago</button>
            </td>
          </tr>
        `;
      });
    } catch (err) {
      tbody.innerHTML = '<tr><td colspan="7">Error al cargar pedidos</td></tr>';
    }
  }

  // Acciones (puedes implementar la l√≥gica en panel.js)
  function verPedido(id) {
    // Mostrar modal con detalles
    // ...implementaci√≥n en panel.js...
  }
  function editarPedido(id) {
    // Mostrar modal de edici√≥n
    // ...implementaci√≥n en panel.js...
  }
  function pagoPedido(id) {
    // Mostrar modal de pago/eliminaci√≥n
    // ...implementaci√≥n en panel.js...
  }

  // Cargar pedidos al iniciar
  window.addEventListener('DOMContentLoaded', cargarPedidos);
</script>
</body>
</html>
