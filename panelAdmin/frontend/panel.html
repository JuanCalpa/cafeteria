<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Panel de Administraci√≥n - Cafeter√≠a</title>
  <link rel="stylesheet" href="panel.css">
</head>
<body>
  <!-- Verificar sesi√≥n al cargar -->
  <script>
    window.addEventListener("DOMContentLoaded", async () => {
      try {
        const res = await fetch("http://localhost:3000/api/verificarSesion", { credentials: "include" });
        const data = await res.json();

        if (!res.ok || data.usuario.rol !== 'administrador') {
          alert("Acceso denegado. Solo para administradores.");
          window.location.href = "/";
          return;
        }
      } catch (err) {
        console.error("Error al verificar sesi√≥n:", err);
        window.location.href = "/";
      }
    });
  </script>
  <!-- Sidebar -->
  <div class="sidebar">
    <h2>‚òï Cafeter√≠a</h2>
    <ul>
      <li class="active" id="btnAdmin">Panel Administraci√≥n</li>
    </ul>
  </div>

  <!-- Contenido principal -->
  <div class="main-content">
    <div class="panel-header">
    <h1>üìã Panel de Administraci√≥n</h1>
      <div>
        <button class="btn btn-nuevo" id="btnAbrirCrear">‚ûï Agregar Producto</button>
        <button class="btn btn-secondary" id="btnLogout" style="margin-left: 10px;">Cerrar Sesi√≥n</button>
      </div>
    </div>

    <div class="tabla-container">
      <table id="tablaPedidos">
        <thead>
          <tr>
            <th>ID</th>
            <th>Usuario</th>
            <th>Correo</th>
            <th>Estado</th>
            <th>Total</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <!-- === MODALES === -->

  <!-- Modal Ver -->
  <div id="modalVer" class="modal">
    <div class="modal-box">
      <span class="close" id="cerrarModalVer">&times;</span>
      <h2>Detalles del Pedido</h2>
      <div id="detallePedidoVer"></div>
    </div>
  </div>

  <!-- Modal Editar -->
  <div id="modalEditar" class="modal">
    <div class="modal-box">
      <span class="close" id="cerrarModalEditar">&times;</span>
      <h2>Editar Pedido</h2>
      <form id="formEditarPedido">
        <input type="hidden" id="editarIdPedido">
        <label for="editarEstado">Estado:</label>
        <select id="editarEstado">
          <option value="pendiente">Pendiente</option>
          <option value="en preparacion">En preparaci√≥n</option>
          <option value="entregado">Entregado</option>
        </select>
        <div class="modal-actions">
          <button type="submit" class="btn btn-editar">Guardar Cambios</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal Pago -->
  <div id="modalPago" class="modal">
    <div class="modal-box">
      <span class="close" id="cerrarModalPago">&times;</span>
      <h2>Gesti√≥n de Pago</h2>
      <div id="detallePedidoPago"></div>
      <div class="modal-actions">
        <button id="btnCambiarPagado" class="btn btn-pagar">Cambiar a Pagado</button>
        <button id="btnEliminarPedido" class="btn btn-eliminar">Eliminar Pedido</button>
      </div>
    </div>
  </div>

  <!-- Modal Agregar Producto -->
  <div id="modalCrear" class="modal">
    <div class="modal-box">
      <span class="close" id="cerrarModalCrear">&times;</span>
      <h2>Agregar Producto</h2>
      <form id="formCrearProducto">
        <div id="productosContainer">
          <div class="producto-item">
            <div style="display: flex; gap: 10px;">
              <div style="flex: 1;">
                <label>Categor√≠a:</label>
                <select class="categoria" required>
                  <option value="">Selecciona categor√≠a</option>
                </select>
              </div>
              <div style="flex: 1;">
                <label>Nombre:</label>
                <input type="text" class="nombre" placeholder="Ej: Caf√©" required>
              </div>
            </div>
            <div style="display: flex; gap: 10px;">
              <div style="flex: 1;">
                <label>Descripci√≥n:</label>
                <input type="text" class="descripcion" placeholder="Ej: Caf√© negro">
              </div>
              <div style="flex: 1;">
                <label>Precio:</label>
                <input type="text" class="precio" placeholder="Ej: $2,500" required>
              </div>
            </div>
            <div style="display: flex; gap: 10px;">
              <div style="flex: 1;">
                <label>Disponibilidad:</label>
                <select class="disponibilidad" required>
                  <option value="TRUE">Disponible</option>
                  <option value="FALSE">No disponible</option>
                </select>
              </div>
              <div style="flex: 1;">
                <button type="button" class="btn btn-eliminar remove-producto">‚ùå Remover</button>
              </div>
            </div>
          </div>
        </div>

        <button type="button" id="btnAgregarOtroProducto" class="btn btn-nuevo">‚ûï Agregar Otro Producto</button>

        <div class="modal-actions">
          <button type="submit" class="btn btn-nuevo">Agregar Productos</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal de Confirmaci√≥n para Editar Pedido -->
  <div id="modalConfirmEdit" class="modal">
    <div class="modal-box">
      <span class="close" id="closeConfirmEdit">&times;</span>
      <h2>‚ö†Ô∏è Confirmar Cambio de Estado</h2>
      <p id="confirmEditText"></p>
      <div class="modal-actions">
        <button id="btnConfirmEditYes" class="btn btn-primary">S√≠, Cambiar</button>
        <button id="btnConfirmEditNo" class="btn btn-secondary">Cancelar</button>
      </div>
    </div>
  </div>

  <!-- Modal de Confirmaci√≥n para Acciones de Pago -->
  <div id="modalConfirmPago" class="modal">
    <div class="modal-box">
      <span class="close" id="closeConfirmPago">&times;</span>
      <h2>‚ö†Ô∏è Confirmar Acci√≥n</h2>
      <p id="confirmPagoText"></p>
      <div class="modal-actions">
        <button id="btnConfirmPagoYes" class="btn btn-primary">S√≠, Proceder</button>
        <button id="btnConfirmPagoNo" class="btn btn-secondary">Cancelar</button>
      </div>
    </div>
  </div>

  <!-- Modal de Confirmaci√≥n para Logout -->
  <div id="modalConfirmLogout" class="modal">
    <div class="modal-box">
      <span class="close" id="closeConfirmLogout">&times;</span>
      <h2>‚ö†Ô∏è Cerrar Sesi√≥n</h2>
      <p>¬øEst√°s seguro de que quieres cerrar sesi√≥n?</p>
      <div class="modal-actions">
        <button id="btnConfirmLogoutYes" class="btn btn-primary">S√≠, Cerrar Sesi√≥n</button>
        <button id="btnConfirmLogoutNo" class="btn btn-secondary">Cancelar</button>
      </div>
    </div>
  </div>

  <script src="/panelAdmin/js/panel.js"></script>
</body>
</html>
